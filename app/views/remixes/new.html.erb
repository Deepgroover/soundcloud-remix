<div class="block">

	<h2 id="form_header">Upload Your Remix</h2>

	<% form_for(@remix, :html => {:multipart => true}) do |f| %>

	  <%= f.error_messages %>
	
		<p id="title"><%= f.label :title, "remix title:" %><br><%= f.text_field :title %></p>
			
		<%= f.file_field :file %>
		
		<p id="info"><small>Files must be smaller than <%= number_to_human_size(SETTINGS["upload_limit"], :precision => 0) -%>. OGG, MP3, AAC</small></p>
		
		<p id="upload">
		
		<script type="text/javascript">document.write('<a href="javascript:startUpload(\'#photo_file\')">Upload</a>');</script>
		
		<noscript><%= f.submit 'Upload' %></noscript>
		
		</p>

	<% end %>

</div>

<%- session_key = ActionController::Base.session_options[:key] -%>

<script type="text/javascript">

	$('#remix_file').uploadify({
		uploader  	: '/flash/uploadify.swf',
		script    	: '/remixes',
		auto     		: false,
		fileDesc		: "Remix",
		fileExt			: "*.mp3;*.m4a;*.ogg;*.wav",
		sizeLimit		: <%= SETTINGS["upload_limit"] -%>,
		buttonText	: "Choose file",
		scriptData	: {
        '<%= session_key -%>'		: '<%= u(cookies[session_key]) -%>',
        'authenticity_token'		: '<%= u(form_authenticity_token) -%>',
				'_http_accept'					: "application/javascript"
    },
		fileDataName : "file",
		onComplete  : function(a, b, c, response, data){ 
			$(".uploadifyHeader").text('Saving...');
			eval(response);
		}
	});
	
	function startUpload(id){

		$('#remix_file').uploadifySettings('hideButton','true');
		$('#remix_fileUploader').width(1);
		$('#remix_fileUploader').height(1);
		
		$('#form_header,#title,#info,#upload').hide();
		
		$('.uploadifyHeader,.uploadifyProgress,.cancel').show();
		
		$('#remix_file').uploadifySettings('scriptData',{'title' : $('#remix_title').val()});
	  $('#remix_file').uploadifyUpload();

	}

</script>